<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Beta Leasing</title>
		<!-- Sets initial viewport load and disables zooming -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- SEO -->
		<meta name="keywords" content="">
		<meta name="description" content="">
		<!-- Compatibility -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta http-equiv="cleartype" content="on">
		<!-- Favicon - generated with http://www.favicomatic.com/ -->
		<link rel="apple-touch-icon-precomposed" sizes="57x57" href="favicon/apple-touch-icon-57x57.png" />
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="favicon/apple-touch-icon-114x114.png" />
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="favicon/apple-touch-icon-72x72.png" />
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="favicon/apple-touch-icon-144x144.png" />
		<link rel="apple-touch-icon-precomposed" sizes="60x60" href="favicon/apple-touch-icon-60x60.png" />
		<link rel="apple-touch-icon-precomposed" sizes="120x120" href="favicon/apple-touch-icon-120x120.png" />
		<link rel="apple-touch-icon-precomposed" sizes="76x76" href="favicon/apple-touch-icon-76x76.png" />
		<link rel="apple-touch-icon-precomposed" sizes="152x152" href="favicon/apple-touch-icon-152x152.png" />
		<link rel="icon" type="image/png" href="favicon/favicon-196x196.png" sizes="196x196" />
		<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/png" href="favicon/favicon-32x32.png" sizes="32x32" />
		<link rel="icon" type="image/png" href="favicon/favicon-16x16.png" sizes="16x16" />
		<link rel="icon" type="image/png" href="favicon/favicon-128.png" sizes="128x128" />
		<meta name="application-name" content="Little Crow"/>
		<meta name="msapplication-TileColor" content="#009C9F" />
		<meta name="msapplication-TileImage" content="favicon/mstile-144x144.png" />
		<meta name="msapplication-square70x70logo" content="favicon/mstile-70x70.png" />
		<meta name="msapplication-square150x150logo" content="favicon/mstile-150x150.png" />
		<meta name="msapplication-wide310x150logo" content="favicon/mstile-310x150.png" />
		<meta name="msapplication-square310x310logo" content="favicon/mstile-310x310.png" />
		<!-- CSS -->
		<link rel="stylesheet" href="css/style.min.css">
		<!-- Google font(s) -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">
		<!-- Font awesome -->
		<!-- <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->

		<!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
		<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
			<script src="js/respond.min.js"></script>
		<![endif]-->

		<!-- Typekit -->
		<!-- <script src="//use.typekit.net/xxxxxx.js"></script> -->
		<!-- <script>try{Typekit.load();}catch(e){}</script> -->
	</head>
	<body>
		<!--[if lt IE 9]>
			<p class="[ chromeframe ]">Estás usando una versión <strong>vieja</strong> de tu explorador. Por favor <a href="http://browsehappy.com/" target="_blank"> actualiza tu explorador</a> para tener una experiencia completa.</p>
		<![endif]-->
		<div class="[ container ]">

			<header class="[ xmall-12 ][ padding--top-bottom--small ][ bg-primary ]">
				
			</header>

			<div class="[ main ]">

				<!-- =================================================
				==== HERO
				================================================== -->
				<section class="[ hero hero-home ]">
					<div class="[ screen screen-dark--30 ][ z-index-1 ]"></div>
					<div class="[ padding-top-bottom--large ][ relative z-index-2 ]">
						<div class="[ wrapper ]">
							<div class="[ text-center ]">
								<h1 class="[ text-shadow ]"></h1>
								<p class="[ margin-bottom--large ]">Beta Leasing es tu mejor opción para la renovación de vehículos, maquinaria y equipo, ofreciendo soluciones personalizadas de arrendamiento puro</p>
								<a href="#" class="[ button button--primary ]">simula tu cotización en línea</a>
							</div>
						</div><!-- wrapper -->
					</div>
				</section><!-- hero -->


				<!-- =================================================
				==== COTIZADOR
				================================================== -->
				<section class="[ margin-bottom--large ]">
					<div class="[ margin-bottom ]">
						<div class="[ wrapper ]">
							<h2 class="[ text-center ]">Cotizador</h2>
							<article class="[ form ]">

								<h3 class="[ text-center ]">Quiero cotizar:</h3>
								<form method="post" action="" id="form-ui">
									<div class="[ row ]">
										<fieldset class="[ column xmall-12 ][ margin-bottom ]">
											<label class="[ field select ]">
												<select id="tipo" name="tipo">
													<option value="vehiculo" selected>Vehículo</option>
													<option value="maquinaria">Maquinaria</option>
													<option value="mobiliario">Mobiliario</option>
												</select>
												<i class="arrow"></i>
											</label>
										</fieldset>
										<fieldset class="[ column xmall-6 ][ margin-bottom ]">
											<label class="field">
												<input type="text" name="marca" class="gui-input" placeholder="Marca">
											</label>
										</fieldset>
										<fieldset class="[ column xmall-6 ][ margin-bottom ]">
											<label class="field">
												<input type="text" name="modelo" class="gui-input" placeholder="Modelo">
											</label>
										</fieldset>
										<fieldset class="[ column xmall-4 ][ margin-bottom ]">
											<label class="field">
												<p><small>Valor total</small></p>
												<input type="text" name="valor_total" class="gui-input" placeholder="$0.00"> 
											</label>
										</fieldset>
										<fieldset class="[ column xmall-4 ][ margin-bottom ]">
											<label class="field">
												<p><small>IVA</small></p>
												<input type="text" name="iva" class="gui-input" placeholder="" value="$0.00"> 
											</label>
										</fieldset>
										<fieldset class="[ column xmall-4 ][ margin-bottom ]">
											<label class="field">
												<p><small>Valor factura</small></p>
												<input type="text" name="valor_factura" class="gui-input" placeholder="" value="$0.00"> 
											</label>
										</fieldset>
										<fieldset class="[ column xmall-12 ][ margin-bottom ]">
											<p><small>Plazo en meses</small></p>
											<div class="[ slider-wrapper ]">
												<div id="slider-meses"></div>
											</div><!-- end .slider-wrapper -->
											<p class="[ row ]"><span class="[ pull-left ][ js-meses ]">12 meses</span></p>
										</fieldset>
										<fieldset class="[ column xmall-12 ][ margin-bottom ]">
											<p><small>Porcentaje (%) de enganche</small></p>
											<div class="[ slider-wrapper ]">
												<div id="slider-enganche"></div>
											</div><!-- end .slider-wrapper -->
											<p class="[ row ]"><span class="[ pull-left ][ js-porcentaje-enganche ]">0%</span></p>
										</fieldset>
										<fieldset class="[ column xmall-6 ][ margin-bottom ]">
											<label class="field">
												<p><small>Monto total a financiar</small></p>
												<input type="text" name="monto_financiar" class="gui-input" placeholder="$0.00">
											</label>
										</fieldset>
										<fieldset class="[ column xmall-6 ][ margin-bottom ]">
											<label class="field">
												<p><small>Mi renta mensual es de:</small></p>
												<input type="text" name="renta_mensual" class="gui-input" placeholder="$0.00">
											</label>
										</fieldset>
										<fieldset class="[ column xmall-12 ][ margin-bottom ][ text-center ]">
											<div class="button">Siguiente</div>
											<p><small>Paso 1 de 2</small></p>
										</fieldset>
									</div>
								</form>

							</article>
						</div>
					</div>
				</section><!-- cotizador -->

			</div><!-- main -->
		</div><!-- container -->

		<footer class="">
			
		</footer>

		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/functions.js"></script>
		<script type="text/javascript" src="js/plugins.min.js"></script>

		<script type="text/javascript" src="js/js-forms/jquery-ui-custom.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery-ui-touch-punch.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery-ui-timepicker.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery-ui-monthpicker.min.js"></script>

		<script type="text/javascript" src="js/js-forms/jquery.spectrum.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery.stepper.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery.steps.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery.form.min.js"></script>
		<script type="text/javascript" src="js/js-forms/jquery.validate.min.js"></script>

		<script type="text/javascript" src="js/js-forms/additional-methods.min.js"></script>
		<script type="text/javascript" src="js/js-forms/smart-form.js"></script>
		<script type="text/javascript">
		var $ = jQuery.noConflict();
		$(function() {

			/*------------------------------------*\
			    #GLOBAL
			\*------------------------------------*/

			/**
			 * On load
			**/

			setMainPaddingTop();
			imgToSvg();


			/**
			 * Triggered events
			**/
			$(window).scroll(function(){
				toggleActionButtons();
			});

			$('.js-modal-opener').on('click', function(e){
				e.preventDefault();
				var modal = $(this).data('modal');
				var modal = '.modal-'+modal;
				toggleModal(modal);
			});

			$('.js-modal-closer').on('click', function(e){
				e.preventDefault();
				toggleModal();
			});


			/*------------------------------------*\
			    #ON RESIZE
			\*------------------------------------*/

			$( window ).resize(function() {
				setMainPaddingTop();
			});


			/*------------------------------------*\
			    #FORMS
			\*------------------------------------*/



				/* @time picker
				------------------------------------------------------------------ */
				$('#timepicker1').timepicker({
					beforeShow: function(input, inst) {
							var newclass = 'form';
							var smartpikr = inst.dpDiv.parent();
							if (!smartpikr.hasClass('form')){
								inst.dpDiv.wrap('<div class="'+newclass+'"></div>');
							}
					}

				});

				$('#timepicker2').timepicker({
					beforeShow: function(input, inst) {
							var newclass = 'form';
							var smartpikr = inst.dpDiv.parent();
							if (!smartpikr.hasClass('form')){
								inst.dpDiv.wrap('<div class="'+newclass+'"></div>');
							}
					}

				});

				/* @date time picker
				------------------------------------------------------------------ */
				$('#dtimepicker1').datetimepicker({
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					beforeShow: function(input, inst) {
							var newclass = 'form';
							var smartpikr = inst.dpDiv.parent();
							if (!smartpikr.hasClass('form')){
								inst.dpDiv.wrap('<div class="'+newclass+'"></div>');
							}
					}

				});

				$('#dtimepicker2').datetimepicker({
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					beforeShow: function(input, inst) {
							var newclass = 'form';
							var smartpikr = inst.dpDiv.parent();
							if (!smartpikr.hasClass('form')){
								inst.dpDiv.wrap('<div class="'+newclass+'"></div>');
							}
					}

				});

				/* @date picker
				------------------------------------------------------------------ */
				$("#datepicker1").datepicker({
					numberOfMonths: 1,
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					showButtonPanel: false
				});

				$("#datepicker2").datepicker({
					numberOfMonths: 1,
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					showButtonPanel: false
				});

				/* @month picker
				------------------------------------------------------------------ */
				$("#month-picker1").monthpicker({
					changeYear: false,
					stepYears: 1,
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					showButtonPanel: true
				});

				$("#month-picker2").monthpicker({
					changeYear: false,
					stepYears: 1,
					prevText: '<i class="fa fa-chevron-left"></i>',
					nextText: '<i class="fa fa-chevron-right"></i>',
					showButtonPanel: true
				});

				/* @color picker
				------------------------------------------------------------------ */
				$("#colorpicker1").spectrum({
					color: "#FCD208"
				});

				$("#colorpicker2").spectrum({
					color: "#D15ADE",
					showInput: true,
					showPalette: true,
					palette: [
						['black', 'white', 'blanchedalmond'],
						['rgb(255, 128, 0);', 'hsv 100 70 50', 'lightyellow']
					]
				});

				$("#colorpicker1, #colorpicker2").show();

				/* @numeric stepper
				------------------------------------------------------------------ */
				$('#stepper3').stepper({
					wheel_step: 0.1,
					arrow_step: 0.2
				});

				$('#stepper4').stepper({
					UI: false,
					allowWheel :false
				});

				/* @ui slider
				------------------------------------------------------------------ */
				$('#slider-enganche').slider({
					min: 10,
					max: 70,
					range: false,
					values: [20],
					step: 5,

					slide: function( event, ui ) {
						$( '.js-porcentaje-enganche' ).text( ui.values[ 0 ] + '%' );
						actualizarValores( getValorTotal() );
					}
				});
				$( '.js-porcentaje-enganche' ).text( $('#slider-enganche').slider( 'values', 0 ) + '%' );

				$('#slider-meses').slider({
					min: 12,
					max: 48,
					range: false,
					values: [36],

					slide: function( event, ui ) {
						$( '.js-meses' ).text( ui.value + ' meses' );
						actualizarValores( getValorTotal() );
					}
				});
				$( '.js-meses' ).text( $('#slider-meses').slider( 'values', 0 ) + ' meses' );
				
				initCotizador();

});
	
	// Funciones cotizador (meter en plugin)
	function getValorTotal(){
		
		var valorTotal = $('input[name="valor_total"]').val().replace(/,/g, '');
		return valorTotal.substring( 1, valorTotal.length );
	}
	function getComision(){
		return 0.2;
	}
	function getMontoFinanciar(){
		var montoFinanciar = $('input[name="monto_financiar"]').val().replace(/,/g, '');
		console.log(montoFinanciar);
		return montoFinanciar.substring( 1, montoFinanciar.length );
	}

	function setIVA( total ){
		var iva = total * 0.16;
		$('input[name="iva"]').val( '$' + formatMoney( iva.toFixed(2) ) );
	}

	function getValorFactura(){
		var valorFactura = $('input[name="valor_factura"]').val().replace(/,/g, '');
		return valorFactura.substring( 1, valorFactura.length );
	}	

	function getPagoInicial( meses, valorFactura ){
		return meses * valorFactura;
	}

	function getPorcentajeEnganche(){
		var porcentajeEnganche = $( '.js-porcentaje-enganche' ).text()
		return porcentajeEnganche.slice(0, -1) / 100;
	}

	function getPlazoMeses(){
		return parseInt( $( '.js-meses' ).text() );
	}

	function getTasaMensual(){
		return 0.26 / 12;
	}

	function getValorResidual(){
		return getValorFactura() * 0.25;
	}

	function setValorFactura( total ){
		var iva = total / 1.16;
		$('input[name="valor_factura"]').val( '$' + formatMoney( iva.toFixed(2) ) );
	}

	function setMontoFinanciar( valorFactura, pagoInicial ){
		var monto = valorFactura - pagoInicial;
		$('input[name="monto_financiar"]').val( '$' + formatMoney( monto.toFixed(2) ) );
	}

	function setRentaMensual( rentaMensual ){
		$('input[name="renta_mensual"]').val( '$' + formatMoney( rentaMensual.toFixed(2) ) );
	}

	function initCotizador(){

		$('input[name="valor_total"]').keydown( function(e) {

			if( invalidKey(e) ){
				e.preventDefault();
				return;
			}

			// Allow arrows
			if(e.keyCode >= 37 && e.keyCode <= 40 ) {
				return;
			}

		});	

		$('input[name="valor_total"]').keyup( function(e) {

			if( invalidKey(e) ){
				e.preventDefault();
				return;
			}

			// Allow arrows
			if(e.keyCode >= 37 && e.keyCode <= 40 ) {
				return;
			}

			$(this).val(function(i,v) {
				actualizarValores( v.replace('$','') );
				return '$' + v.replace('$',''); //remove exisiting, add back.
			});
		});	

		$('input[name="valor_total"]').focusout( function(e) {
			var formattedValue = $(this).val().replace('$','');

			$(this).val( '$' + formatMoney(formattedValue) );
		});
	}

	function invalidKey( e ) {
		// Allow: backspace, delete, tab, escape, enter and .
		//alert( e.keyCode );
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190 ]) !== -1 ||
             // Allow: Ctrl+A
            (e.keyCode == 65 && e.ctrlKey === true) ||
             // Allow: Ctrl+C
            (e.keyCode == 67 && e.ctrlKey === true) ||
             // Allow: Ctrl+X
            (e.keyCode == 88 && e.ctrlKey === true) ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
                 return false;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            return true;
        }
	}

	function actualizarValores( valorTotal ){
		var valorFactura, pagoInicial, montoFinanciar, valorResidual, plazo, tasaMensual, porcentajeEnganche; 

		setValorFactura( valorTotal );
		valorFactura = getValorFactura();
		setIVA( getValorFactura() );

		porcentajeEnganche = getPorcentajeEnganche();
		pagoInicial = getPagoInicial( porcentajeEnganche, valorFactura );
		setMontoFinanciar( valorFactura, pagoInicial );		
		montoFinanciar = getMontoFinanciar();

		valorResidual = getValorResidual();
		tasaMensual = getTasaMensual();
		plazo = getPlazoMeses();
		
		setRentaMensual( calculaRentaMensual( tasaMensual, plazo, montoFinanciar,  valorResidual ) * 1.16 );

		console.clear();
		console.log('tasa mensual: ' + tasaMensual );
		console.log('plazo: ' + plazo );
		console.log('monto a financiar: $' + montoFinanciar );
		console.log('valorResidual: $' + valorResidual );
		console.log( 'pago mensual: $' + calculaRentaMensual( tasaMensual, plazo, montoFinanciar,  valorResidual ) * 1.16 );
	}

	function calculaRentaMensual( tasaMensual, plazo, montoFinanciar, valorResidual ){
		if( ! valorResidual ){ valorResidual = 0; }
		
		return tasaMensual * ( montoFinanciar * -1 * Math.pow((1 + tasaMensual), plazo) + valorResidual ) / (1 - Math.pow((1 + tasaMensual), plazo));
	}

	function formatMoney(n){
		var digitosDecimales = 2;
		var signo = n < 0 ? "-" : ""; 
		i = parseInt(n = Math.abs(+n || 0).toFixed(digitosDecimales)) + "";
		j = (j = i.length) > 3 ? j % 3 : 0;
		return signo + (j ? i.substr(0, j) + "," : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + ",") + (digitosDecimales ? "." + Math.abs(n - i).toFixed(digitosDecimales).slice(2) : "");
	};

</script>
	</body>
</html>